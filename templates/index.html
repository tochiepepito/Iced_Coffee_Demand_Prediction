<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lokal Kofi - Iced Coffee Demand Predict</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>
<body>
    <div class="main-container">
        <!-- LEFT SIDE - Visual Display -->
        <div class="visual-section">
            <div id="default-background"></div>
            
            <!-- Collage container -->
            <div id="image-collage"></div>
            
            <!-- Weather Layer -->
            <img id="weather-layer" class="background-layer" src="" alt="">
            <video id="weather-video" class="background-layer" loop>
                <source id="weather-video-source" src="" type="video/mp4">
            </video>
            
            <!-- Holiday Layer -->
            <img id="holiday-layer" class="background-layer" src="" alt="">
            <video id="holiday-video" class="background-layer" loop>
                <source id="holiday-video-source" src="" type="video/mp4">
            </video>
            
            <!-- Event Layer -->
            <img id="event-layer" class="background-layer" src="" alt="">
            <video id="event-video" class="background-layer" loop>
                <source id="event-video-source" src="" type="video/mp4">
            </video>
            
            <div class="visual-overlay"></div>
            
            <!-- Visual Caption -->
            <div class="visual-caption">
                <h2>Predict Your Coffee Demand</h2>
                <p>Enter conditions to forecast iced coffee sales</p>
            </div>

            <!-- Active Layers Badge -->
            <div class="active-layers" id="active-layers-badge"></div>
            
            <!-- Volume Control -->
            <div class="volume-control" id="volume-control">
                <button id="mute-toggle">ðŸ”Š</button>
                <input type="range" id="volume-slider" min="0" max="100" value="50">
            </div>
        </div>

        <!-- RIGHT SIDE - Form Section -->
        <div class="form-section">
            <div class="form-header">
                <h1>Lokal Kofi</h1>
                <p>Iced Coffee Demand Prediction</p>
            </div>

            <form method="post" action="/">
                <div class="form-group">
                    <label>Date</label>
                    <div class="date-inputs">
                        <input type="number" name="month" placeholder="MM" min="1" max="12" required>
                        <input type="number" name="day" placeholder="DD" min="1" max="31" required>
                        <input type="number" name="year" placeholder="YYYY" min="2000" max="2100" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Time of Day</label>
                    <select name="time_of_day" required>
                        <option value="">Select Time of Day</option>
                        <option value="morning">Morning</option>
                        <option value="afternoon">Afternoon</option>
                        <option value="evening">Evening</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Temperature (Â°C)</label>
                    <input type="number" name="temperature" placeholder="Enter temperature" step="0.1" required>
                </div>

                <div class="form-group">
                    <label>Weather Condition</label>
                    <select name="weather" id="weather-select">
                        <option value="">Select Weather</option>
                        <option value="Sunny">Sunny</option>
                        <option value="Rain">Rain</option>
                        <option value="Thunder">Thunder</option>
                        <option value="Clear">clear</option>
                        <option value="Cloudy">Cloudy</option>
                        <option value="Mist"> Mist</option>
                        <option value="Overcast"> Overcast</option>
                        <option value="Rain"> Patchy Rain</option>
                        <option value="Fog">Fog</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Holiday</label>
                    <select name="holiday" id="holiday-select">
                        <option value="Regular Day">Regular Day</option>
                        <option value="Christmas">Christmas</option>
                        <option value="Holy Week">Good Friday</option>
                        <option value="Holy Week">Holy Saturday</option>
                        <option value="New Year">New Year</option>
                        <option value="Labor Day">Labor Day</option>
                        <option value="National Heroes Day">National Heroes Day</option>
                        <option value="Bukidnon Founding Anniversary">Bukidnon Founding Anniversary</option>
                        <option value="Halloween">Halloween</option>
                        <option value="Araw ng Kagitingan">Araw ng Kagitingan</option>
                        <option value="Independence Day">Independence Day</option>
                        <option value="Eid-ul-Fitr">Eid-ul-Fitr</option>
                        <option value="Bonifacio Day">Bonifacio Day</option>
                        <option value="Rizal Day">Rizal Day</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>University Event</label>
                    <select name="university_event" id="event-select">
                        <option value="Regular Day">Regular Day</option>
                        <option value="Palaro">Palaro (Sports Fest)</option>
                        <option value="Exam">Exam Week</option>
                        <option value="Enrollment">Enrollment</option>
                        <option value="Valentines Day">Feb-ibig (Love Month)</option>
                        <option value="Teachers Day">Teacher's Day</option>
                        <option value="Founding Anniversary">Founding Anniversary</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Day of Week (auto-calculated)</label>
                    <input type="text" name="day_of_week" placeholder="Day of Week" readonly>
                </div>

                <button type="submit" class="predict-button">Predict Demand</button>

                {% if error %}
                    <div class="result error">{{ error }}</div>
                {% endif %}

                {% if prediction %}
                    <div class="result prediction">{{ prediction }}</div>
                {% endif %}
            </form>

            <div class="action-buttons">
                <a href="/download_predictions" class="action-button download-btn">
                    ðŸ“¥ Download CSV
                </a>
                <a href="/view_predictions" class="action-button view-btn">
                    ðŸ“Š View History
                </a>
            </div>
        </div>
    </div>

    <script>
        const visualContent = {
            'Sunny': { type: 'video', src: '/static/visuals/sunny.mp4', caption: 'Sunny' },
            'Rain': { type: 'video', src: '/static/visuals/rain.mp4', caption: 'Rain' },
            'Thunder': { type: 'video', src: '/static/visuals/thunder.mp4', caption: 'Thunder' },
            'Clear': { type: 'image', src: '/static/visuals/clear.jpg', caption: 'Clear' },
            'Cloudy': { type: 'video', src: '/static/visuals/cloudy.mp4', caption: 'Cloudy' },
            'Fog': { type: 'video', src: '/static/visuals/fog.mp4', caption: 'Fog' },
            'Mist': { type: 'video', src: '/static/visuals/mist.mp4', caption: 'Mist' },
            'Overcast': { type: 'image', src: '/static/visuals/overcast.jpg', caption: 'Overcast' },
            'Christmas': { type: 'video', src: '/static/visuals/christmas.mp4', caption: 'Christmas' },
            'Holy Week': { type: 'image', src: '/static/visuals/holyweek.jpg', caption: 'Holy Week' },
            'New Year': { type: 'video', src: '/static/visuals/newyear.mp4', caption: 'New Year' },
            'Labor Day': { type: 'image', src: '/static/visuals/laborday.jpg', caption: 'Labor Day' },
            'Valentines Day': { type: 'video', src: '/static/visuals/valentines.mp4', caption: 'Valentines Day' },
            'National Heroes Day': { type: 'image', src: '/static/visuals/heroes.jpg', caption: 'National Heroes Day' },
            'Bukidnon Founding Anniversary': { type: 'image', src: '/static/visuals/founding.jpg', caption: 'Bukidnon Founding Anniversary' },
            'Halloween': { type: 'video', src: '/static/visuals/halloween.mp4', caption: 'Halloween' },
            'Araw ng Kagitingan': { type: 'image', src: '/static/visuals/kagitingan.jpg', caption: 'Araw ng Kagitingan' },
            'Independence Day': { type: 'image', src: '/static/visuals/independence.jpg', caption: 'Independence Day' },
            'Eid-ul-Fitr': { type: 'image', src: '/static/visuals/eid.jpg', caption: 'Eid-ul-Fitr' },
            'Bonifacio Day': { type: 'image', src: '/static/visuals/bonifacio.jpg', caption: 'Bonifacio Day' },
            'Rizal Day': { type: 'image', src: '/static/visuals/rizal.jpg', caption: 'Rizal Day' },
            'Palaro': { type: 'video', src: '/static/visuals/palaro.mp4', caption: 'Palaro' },
            'Exam': { type: 'image', src: '/static/visuals/exam.jpg', caption: 'Exam Week' },
            'Teachers Day': { type: 'video', src: '/static/visuals/teachersday.mp4', caption: 'Teacher\'s Day' },
            'Enrollment': { type: 'image', src: '/static/visuals/enrollment.jpg', caption: 'Enrollment' },
            'Founding Anniversary': { type: 'video', src: '/static/visuals/founding.mp4', caption: 'Founding Anniversary' },
        };

        let activeVideos = [];
        let activeImages = [];

        function updateLayer(layerType, value) {
            const imgLayer = document.getElementById(`${layerType}-layer`);
            const videoLayer = document.getElementById(`${layerType}-video`);
            const videoSource = document.getElementById(`${layerType}-video-source`);
            
            imgLayer.classList.remove('active');
            videoLayer.classList.remove('active');
            if (!videoLayer.paused) {
                videoLayer.pause();
                activeVideos = activeVideos.filter(v => v !== videoLayer);
            }
            
            activeImages = activeImages.filter(img => img.layer !== layerType);
            
            if (value && value !== '' && value !== 'Regular Day' && visualContent[value]) {
                const content = visualContent[value];
                
                if (content.type === 'image') {
                    activeImages.push({ layer: layerType, src: content.src, caption: content.caption });
                } else if (content.type === 'video') {
                    videoSource.src = content.src;
                    videoLayer.load();
                    videoLayer.volume = document.getElementById('volume-slider').value / 100;
                    videoLayer.classList.add('active');
                    activeVideos.push(videoLayer);
                    videoLayer.play().catch(() => playVideosOnClick());
                }
            }
            
            updateImageDisplay();
            updateActiveLayers();
            updateVolumeControl();
        }

        function updateImageDisplay() {
            const collage = document.getElementById('image-collage');
            const weatherImg = document.getElementById('weather-layer');
            const holidayImg = document.getElementById('holiday-layer');
            const eventImg = document.getElementById('event-layer');
            
            weatherImg.classList.remove('active');
            holidayImg.classList.remove('active');
            eventImg.classList.remove('active');
            collage.classList.remove('active', 'two-images', 'three-images');
            collage.innerHTML = '';
            
            if (activeImages.length > 1) {
                if (activeImages.length === 2) collage.classList.add('two-images');
                else if (activeImages.length === 3) collage.classList.add('three-images');
                
                activeImages.forEach(imgData => {
                    const img = document.createElement('img');
                    img.src = imgData.src;
                    img.className = 'collage-image';
                    img.alt = imgData.caption;
                    collage.appendChild(img);
                });
                
                collage.classList.add('active');
            } else if (activeImages.length === 1) {
                const imgData = activeImages[0];
                const imgElement = document.getElementById(`${imgData.layer}-layer`);
                imgElement.src = imgData.src;
                imgElement.classList.add('active');
            }
        }

        function updateActiveLayers() {
            const badge = document.getElementById('active-layers-badge');
            const weather = document.getElementById('weather-select').value;
            const holiday = document.getElementById('holiday-select').value;
            const event = document.getElementById('event-select').value;
            
            let tags = [];
            if (weather && visualContent[weather]) tags.push(visualContent[weather].caption);
            if (holiday !== 'Regular Day' && visualContent[holiday]) tags.push(visualContent[holiday].caption);
            if (event !== 'Regular Day' && visualContent[event]) tags.push(visualContent[event].caption);
            
            if (tags.length > 0) {
                badge.innerHTML = '<strong>Active:</strong> ' + tags.map(t => `<span class="layer-tag">${t}</span>`).join('');
                badge.classList.add('show');
            } else {
                badge.classList.remove('show');
            }
        }

        function updateVolumeControl() {
            const volumeControl = document.getElementById('volume-control');
            volumeControl.classList.toggle('active', activeVideos.length > 0);
        }

        function playVideosOnClick() {
            if (activeVideos.some(v => v.paused)) {
                document.addEventListener('click', function playOnClick() {
                    activeVideos.forEach(v => v.play());
                    document.removeEventListener('click', playOnClick);
                }, { once: true });
            }
        }

        document.getElementById('mute-toggle').addEventListener('click', function() {
            const isMuted = activeVideos[0]?.muted || false;
            activeVideos.forEach(video => video.muted = !isMuted);
            this.textContent = !isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
        });

        document.getElementById('volume-slider').addEventListener('input', function() {
            const volume = this.value / 100;
            activeVideos.forEach(video => video.volume = volume);
            document.getElementById('mute-toggle').textContent = volume === 0 ? 'ðŸ”‡' : 'ðŸ”Š';
        });

        document.getElementById('weather-select').addEventListener('change', function() {
            updateLayer('weather', this.value);
        });

        document.getElementById('holiday-select').addEventListener('change', function() {
            updateLayer('holiday', this.value);
        });

        document.getElementById('event-select').addEventListener('change', function() {
            updateLayer('event', this.value);
        });

        function updateDayOfWeek() {
            const month = document.querySelector('input[name="month"]').value;
            const day = document.querySelector('input[name="day"]').value;
            const year = document.querySelector('input[name="year"]').value;
            
            if (month && day && year) {
                const date = new Date(year, month - 1, day);
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                document.querySelector('input[name="day_of_week"]').value = days[date.getDay()];
            }
        }
        
        document.querySelector('input[name="month"]').addEventListener('change', updateDayOfWeek);
        document.querySelector('input[name="day"]').addEventListener('change', updateDayOfWeek);
        document.querySelector('input[name="year"]').addEventListener('change', updateDayOfWeek);
    </script>
</body>
</html>